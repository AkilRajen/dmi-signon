<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Form - Direct View</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Test Form (No Auth Required)</h1>
        </header>

        <main>
            <div id="form-section">
                <h2>Submit Your Information</h2>
                <p style="margin-bottom: 20px; color: #666;">Please fill in your details below. Fields marked with * are required.</p>
                <form id="ad-form">
                    <div id="form-fields"></div>
                    <button type="submit" class="btn-primary">Submit</button>
                </form>
            </div>

            <div id="success-section" style="display: none;">
                <h2>Success!</h2>
                <p>Your information has been submitted successfully.</p>
                <button onclick="location.reload()" class="btn-primary" style="margin-top: 20px;">Submit Another</button>
            </div>
        </main>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            console.log('Page loaded, rendering form...');
            
            // Get form fields (using CRM field names)
            const fields = [
                { name: 'LeadFirstName', label: 'First Name', type: 'text', required: true, maxLength: 100 },
                { name: 'LeadLastName', label: 'Last Name', type: 'text', required: true, maxLength: 100 },
                { name: 'LeadEmail', label: 'Email', type: 'email', required: true },
                { name: 'LeadMobile', label: 'Phone Number', type: 'tel', required: true },
                { name: 'LeadPublicationName', label: 'Publication', type: 'text', required: true, maxLength: 200 },
                { name: 'LeadDescription', label: 'Description', type: 'textarea', required: true, maxLength: 1000 },
                { name: 'LeadCountry', label: 'Country', type: 'select', required: false, default: 'United Arab Emirates',
                  options: ['United Arab Emirates', 'Saudi Arabia', 'Qatar', 'Kuwait', 'Bahrain', 'Oman', 
                           'United States', 'United Kingdom', 'Canada', 'Australia', 'Germany', 'France', 
                           'India', 'China', 'Japan', 'Brazil', 'Mexico', 'South Africa', 'Other'] },
                { name: 'LeadAddress', label: 'Address', type: 'textarea', required: false, maxLength: 500 }
            ];
            
            renderFormFields(fields);
            
            // Render form fields
            function renderFormFields(fields) {
                console.log('Rendering fields:', fields);
                const formFieldsContainer = $('#form-fields');
                formFieldsContainer.empty();
                
                fields.forEach(function(field) {
                    const formGroup = $('<div class="form-group"></div>');
                    const label = $(`<label for="${field.name}">${field.label}${field.required ? ' *' : ''}</label>`);
                    formGroup.append(label);
                    
                    let input;
                    if (field.type === 'textarea') {
                        input = $(`<textarea id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''} ${field.maxLength ? 'maxlength="' + field.maxLength + '"' : ''}></textarea>`);
                        if (field.default) {
                            input.val(field.default);
                        }
                    } else if (field.type === 'select') {
                        input = $(`<select id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''}></select>`);
                        input.append('<option value="">Select...</option>');
                        field.options.forEach(function(option) {
                            const selected = field.default && option === field.default ? 'selected' : '';
                            input.append(`<option value="${option}" ${selected}>${option}</option>`);
                        });
                    } else {
                        input = $(`<input type="${field.type}" id="${field.name}" name="${field.name}" ${field.required ? 'required' : ''} ${field.maxLength ? 'maxlength="' + field.maxLength + '"' : ''}>`);
                        if (field.default) {
                            input.val(field.default);
                        }
                    }
                    
                    // Add character counter for fields with maxLength
                    if (field.maxLength && (field.type === 'text' || field.type === 'textarea')) {
                        const counter = $(`<div class="char-counter"><span class="char-count">0</span> / ${field.maxLength}</div>`);
                        formGroup.append(input);
                        formGroup.append(counter);
                        
                        input.on('input', function() {
                            const length = $(this).val().length;
                            formGroup.find('.char-count').text(length);
                            if (length >= field.maxLength) {
                                formGroup.find('.char-counter').addClass('limit-reached');
                            } else {
                                formGroup.find('.char-counter').removeClass('limit-reached');
                            }
                        });
                    } else {
                        formGroup.append(input);
                    }
                    
                    formFieldsContainer.append(formGroup);
                });
                
                console.log('Form fields rendered successfully');
            }
            
            // Handle form submission
            $('#ad-form').on('submit', function(e) {
                e.preventDefault();
                
                const formData = {};
                $(this).serializeArray().forEach(function(field) {
                    formData[field.name] = field.value;
                });
                
                console.log('Form submitted:', formData);
                
                $('#form-section').hide();
                $('#success-section').show();
            });
        });
    </script>
</body>
</html>
