<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cognito Configuration Check</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .error { color: #e74c3c; }
        .success { color: #27ae60; }
        .warning { color: #f39c12; }
        pre { background: #f8f8f8; padding: 10px; overflow-x: auto; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>Cognito Configuration Checker</h1>
    
    <div class="box">
        <h3>Current Configuration</h3>
        <div id="config"></div>
    </div>

    <div class="box">
        <h3>Generated URLs</h3>
        <div id="urls"></div>
    </div>

    <div class="box">
        <h3>Required Cognito Settings</h3>
        <ol>
            <li><strong>Domain:</strong> Must be configured in Cognito User Pool → App integration → Domain</li>
            <li><strong>App Client:</strong> Must have Hosted UI enabled</li>
            <li><strong>Callback URLs:</strong> Must include <code id="callback-url"></code></li>
            <li><strong>Identity Providers:</strong> Must have at least one social provider enabled (Google, Facebook, Apple, Microsoft)</li>
            <li><strong>OAuth Flows:</strong> Must have "Authorization code grant" enabled</li>
            <li><strong>OAuth Scopes:</strong> Must have "openid", "email", "profile" enabled</li>
        </ol>
    </div>

    <div class="box">
        <h3>Test Login</h3>
        <button onclick="testGoogle()">Test Google Login</button>
        <button onclick="testFacebook()">Test Facebook Login</button>
        <button onclick="testApple()">Test Apple Login</button>
        <button onclick="testMicrosoft()">Test Microsoft Login</button>
        <button onclick="testHostedUI()">Test Hosted UI (All Providers)</button>
    </div>

    <script src="config.js"></script>
    <script>
        // Display config
        document.getElementById('config').innerHTML = `
            <pre>${JSON.stringify(CONFIG.cognito, null, 2)}</pre>
        `;

        // Build URLs
        function buildLoginUrl(provider) {
            const params = new URLSearchParams({
                client_id: CONFIG.cognito.clientId,
                response_type: CONFIG.cognito.responseType,
                scope: CONFIG.cognito.scope,
                redirect_uri: CONFIG.cognito.redirectUri
            });
            
            if (provider) {
                params.append('identity_provider', provider);
            }
            
            return `https://${CONFIG.cognito.domain}/oauth2/authorize?${params.toString()}`;
        }

        // Display URLs
        const hostedUIUrl = buildLoginUrl();
        const googleUrl = buildLoginUrl('Google');
        
        document.getElementById('urls').innerHTML = `
            <p><strong>Hosted UI URL:</strong></p>
            <pre>${hostedUIUrl}</pre>
            <p><strong>Google Direct URL:</strong></p>
            <pre>${googleUrl}</pre>
        `;

        document.getElementById('callback-url').textContent = CONFIG.cognito.redirectUri;

        // Test functions
        function testGoogle() {
            window.location.href = buildLoginUrl('Google');
        }

        function testFacebook() {
            window.location.href = buildLoginUrl('Facebook');
        }

        function testApple() {
            window.location.href = buildLoginUrl('SignInWithApple');
        }

        function testMicrosoft() {
            window.location.href = buildLoginUrl('Microsoft');
        }

        function testHostedUI() {
            window.location.href = buildLoginUrl();
        }

        // Check domain
        console.log('Checking Cognito domain...');
        fetch(`https://${CONFIG.cognito.domain}/.well-known/openid-configuration`)
            .then(response => {
                if (response.ok) {
                    console.log('✓ Cognito domain is accessible');
                    return response.json();
                } else {
                    console.error('✗ Cognito domain not accessible');
                }
            })
            .then(data => {
                console.log('OpenID Configuration:', data);
            })
            .catch(error => {
                console.error('✗ Error checking Cognito domain:', error);
            });
    </script>
</body>
</html>
